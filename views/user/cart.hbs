<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="public/stylesheets/cart.css">
</head>
<body class="c-body">

<div class="card" style="margin-top:30px">
            <div class="row">
                <div class="col-md-8 cart">
                    
                    <div class="title">
                        <div class="row">
                            <div class="col"><h4><b>Shopping Cart</b></h4></div>
                            {{!-- <div class="col align-self-center text-right text-muted">{{this.product.quantity}} Items</div> --}}
                        </div>
                    </div>
                   
                    {{#each products}}    
                    <div class="row border-top border-bottom">
                        <div class="row main align-items-center">
                        
                                 <div class="col-2"><img class="img-fluid" src="../../public/product-images/{{this.product.image}}"></div>
                            <div class="col">
                                <div class="row text-muted">{{this.product.product}}</div>
                                <div class="row">{{this.product.Category}}</div>
                            </div>
                            <div class="col" id="{{this.product._id}}1">{{this.product.price}}</div>
                            <div class="col">
                                <button class="cart-item-count mr-3"  onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user}}',-1)">-</button>
                                <span id="{{this.product._id}}">{{this.quantity}}</span>
                                <button class="cart-item-count ml-3" onclick="changeQuantity('{{this._id}}','{{this.product._id}}','{{../user}}',1)">+</button>
                            </div>
                            <div class="col" id="{{this.product._id}}2">{{this.productTotal}}</div>
                            <div>
                               <a href="/deleteCartProduct/{{this._id}}/{{this.product._id}}" class="close"></a> 
                            </div>
                           
                        </div>
                    </div>
                    {{/each}}
                    <div class="back-to-shop"><a href="/view-product">&leftarrow;</a><span class="text-muted">Back to shop</span></div>
                </div>
                <div class="col-md-4 summary">
                    <div><h5><b>Summary</b></h5></div>
                    <hr>
                    <div class="row">
                        <div class="col" style="padding-left:0;">{{cartCount}} Items</div>
                        {{!-- <div class="col text-right" id="{{this.product._id}}2">{{this.productTotal}}</div> --}}
                    </div>
                    <form>
                        <p>SHIPPING</p>
                        <select><option class="text-muted">Standard-Delivery- &euro;5.00</option></select>
                        <p>GIVE CODE</p>
                        <input id="code" placeholder="Enter your code">
                    </form>
                    <div class="row" style="border-top: 1px solid rgba(0,0,0,.1); padding: 2vh 0;">
                        <div class="col">TOTAL PRICE</div>
                        <div class="col text-right" id="total">{{total}}</div>
                    </div>
                    <a href="/place-order" class="btn btn-dark">PLACE ORDER</a>
                </div>
            </div>
            
        </div>
        {{!-- {{else}}
        <section>
            <div>
                <p>No items in cart</p>
                <img src="https://ibellstore.com/images/no-item-found-here.png" alt="">
            </div>
        </section>
        {{/if}} --}}
         <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></script>
      <script>
        function changeQuantity(cartId,proId,userId,count){
            let price=parseInt(document.getElementById(proId+1).innerHTML)
            let quantity = parseInt(document.getElementById(proId).innerHTML)
            count=parseInt(count)
            $.ajax({
                url:'/change-product-quantity',
                data:{
                    user:userId,
                    cart:cartId,
                    product:proId,
                    count:count,
                    quantity:quantity
                },
                method:'post',
                success:(response)=>{
                    if(response.removeProduct){
                        alert("Product Removed from cart")
                        location.reload()
                    }else{
                        console.log(response)
                        document.getElementById(proId).innerHTML=quantity+count
                        document.getElementById('total').innerHTML=response.total
                        document.getElementById(proId+2).innerHTML=(quantity+count)*price
                    }
                }
            })
        }
      </script>

        </body>
</html>





         